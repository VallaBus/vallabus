<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Asistente de reclamaciones a AUVASA - VallaBus</title>
    <meta name="description" content="Genera en segundos una reclamación a AUVASA que se registrará oficialmente con el ayuntamiento">
    <meta name="keywords" content="AUVASA, Valladolid, transporte público, bus, VallaBus, reclamaciones, quejas">
    <meta name="author" content="VallaBus">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://vallabus.com/reclama">
    <meta property="og:title" content="Asistente de reclamaciones a AUVASA - VallaBus">
    <meta property="og:description" content="Genera en segundos una reclamación a AUVASA que se registrará oficialmente con el ayuntamiento">
    <meta property="og:image" content="https://vallabus.com/reclama/img/social-preview.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://vallabus.com/reclama">
    <meta property="twitter:title" content="Asistente de reclamaciones a AUVASA - VallaBus">
    <meta property="twitter:description" content="Genera en segundos una reclamación a AUVASA que se registrará oficialmente con el ayuntamiento">
    <meta property="twitter:image" content="https://vallabus.com/reclama/img/social-preview.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="../favicon.png">
    <link rel="apple-touch-icon" href="../favicon.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        .card-icon, .text-primary, .text-vallabus {
            color: hsl(168.8, 23.2%, 30.5%);
        }

        .text-secondary {
            color: #2b7b6c;
        }

        a {
            color: hsl(168.8, 23.2%, 30.5%);
            text-decoration: underline;
            font-weight: bold;
        }

        #share-button {
            background-color: hsl(168.8, 48.2%, 95%);
        }

        .bg-vallabus {
            background-color: hsl(168.8, 48.2%, 32.5%);
        }

        .bg-vallabus-light {
            background-color: hsl(168.8, 48.2%, 95%);
        }

        .border-vallabus {
            border-color: hsl(168.8, 48.2%, 32.5%);
        }

        .border-vallabus-light {
            border-color: hsl(168.8, 48.2%, 90%);
        }
        
        #bluesky-icon {
            background-image: url('../img/bluesky-square.png');
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen sm:p-8 p-2">
    <div class="max-w-2xl mx-auto space-y-2">
        <a href="/?mtm_campaign=reclamaback" class="inline-flex items-center gap-1 text-sm text-gray-500 hover:text-gray-700 transition-colors">
            <i data-lucide="arrow-left" class="h-4 w-4"></i>
            vallabus.com
        </a>
        
        <div class="bg-white rounded-lg shadow-sm border border-gray-100 p-6 space-y-6">
            <div class="flex items-center gap-2 mb-4">
                <i data-lucide="message-circle-warning" class="h-6 w-6 text-vallabus"></i>
                <h1 class="text-xl font-semibold text-vallabus">Asistente de reclamaciones</h1>
            </div>

            <div class="flex justify-center gap-8 pt-2">
                <div class="flex items-center gap-2">
                    <i data-lucide="users" class="h-5 w-5 text-vallabus"></i>
                    <span id="total-reclamaciones" class="font-bold text-vallabus">0</span> reclamaciones
                </div>
                <div class="flex items-center gap-2">
                    <i data-lucide="building-2" class="h-5 w-5 text-vallabus"></i>
                    <span id="total-barrios" class="font-bold text-vallabus">0</span> barrios
                </div>
            </div>
            
            <p class="text-gray-600 text-sm bg-vallabus-light p-6 rounded-lg space-y-4">
                <span>El ayuntamiento <a class="underline" href="https://bsky.app/profile/vallabus.com/post/3lgt5wzzswk2j" target="_blank">rechazó en el pleno del 27/1/25</a> realizar ninguna mejora para cumplir los horarios de AUVASA</span>
                <span class="flex items-center gap-2 mb-2">
                    Este formulario te ayuda a autorellenar en segundos una reclamación oficial, ¡entre todos podremos conseguir cambios!
                </span>
            </p>
            
            <form id="complaintForm" class="space-y-6">
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-700">¿Cómo te llamas? *</label>
                    <input type="text" id="nombre" required placeholder="Ej: María" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-vallabus focus:border-vallabus">
                    <div class="error-message hidden text-red-600 text-sm" id="nombre-error">Este campo es obligatorio</div>
                </div>
                
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-700">¿En qué barrio resides? (opcional)</label>
                    <select id="barrio" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-vallabus focus:border-vallabus">
                        <option value="">Selecciona uno</option>
                        <option value="Arturo Eyries">Arturo Eyries</option>
                        
                        <option value="Barrio España">Barrio España</option>
                        
                        <option value="Batallas">Batallas</option>
                        
                        <option value="Belén - Pilarica">Belén - Pilarica</option>
                        
                        <option value="Campo Grande">Campo Grande</option>
                        
                        <option value="Caño Argales">Caño Argales</option>
                        
                        <option value="Circular">Circular</option>
                        
                        <option value="Coto de Simancas">Coto de Simancas</option>
                        
                        <option value="Covaresa">Covaresa</option>
                        
                        <option value="Cuatro de Marzo">Cuatro de Marzo</option>
                        
                        <option value="Delicias - Arco de Ladrillo">Delicias - Arco de Ladrillo</option>
                        
                        <option value="Delicias - Canterac">Delicias - Canterac</option>
                        
                        <option value="El Berrocal">El Berrocal</option>
                        
                        <option value="El Peral">El Peral</option>
                        
                        <option value="El Pinar">El Pinar</option>
                        
                        <option value="Girón">Girón</option>
                        
                        <option value="Hospital">Hospital</option>
                        
                        <option value="Huerta del Rey">Huerta del Rey</option>
                        
                        <option value="La Antigua - Santa Cruz">La Antigua - Santa Cruz</option>
                        
                        <option value="La Cistérniga">La Cistérniga</option>

                        <option value="La Farola">La Farola</option>
                        
                        <option value="La Overuela">La Overuela</option>
                        
                        <option value="La Rubia">La Rubia</option>
                        
                        <option value="La Victoria">La Victoria</option>
                        
                        <option value="Las Flores">Las Flores</option>
                        
                        <option value="Las Villas - Valparaíso">Las Villas - Valparaíso</option>
                        
                        <option value="Pajarillos Altos">Pajarillos Altos</option>
                        
                        <option value="Pajarillos Bajos">Pajarillos Bajos</option>
                        
                        <option value="Parque Alameda - Paula López">Parque Alameda - Paula López</option>
                        
                        <option value="Parquesol">Parquesol</option>
                        
                        <option value="Pilarica - Los Santos">Pilarica - Los Santos</option>
                        
                        <option value="Plaza de Toros">Plaza de Toros</option>
                        
                        <option value="Plaza España">Plaza España</option>
                        
                        <option value="Plaza Mayor">Plaza Mayor</option>
                        
                        <option value="Polígono Argales">Polígono Argales</option>
                        
                        <option value="Polígono Industrial la Mora">Polígono Industrial la Mora</option>
                        
                        <option value="Polígono San Cristóbal">Polígono San Cristóbal</option>
                        
                        <option value="Puente Duero">Puente Duero</option>
                        
                        <option value="Rondilla">Rondilla</option>
                        
                        <option value="San Isidro">San Isidro</option>
                        
                        <option value="San Pablo - San Nicolás">San Pablo - San Nicolás</option>
                        
                        <option value="San Pedro Regalado">San Pedro Regalado</option>

                        <option value="Simancas">Simancas</option>
                        
                        <option value="Soto de Medinilla">Soto de Medinilla</option>
                        
                        <option value="Urbanización El Pichón">Urbanización El Pichón</option>
                        
                        <option value="Urbanización El Plantío">Urbanización El Plantío</option>
                        
                        <option value="Urbanización Entrepinos">Urbanización Entrepinos</option>
                        
                        <option value="Urbanización Las Aceñas">Urbanización Las Aceñas</option>
                        
                        <option value="Vadillos">Vadillos</option>
                        
                        <option value="Villa del Prado">Villa del Prado</option>
                    </select>
                </div>
                
                <div class="space-y-2">
                    <label class="block text-sm font-medium text-gray-700">¿Qué líneas utilizas? (opcional)</label>
                    <select id="lineas" multiple class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-vallabus focus:border-vallabus min-h-[120px]">
                        <option value="1">1</option>
                        
                        <option value="2">2</option>
                    
                        <option value="3">3</option>
                    
                        <option value="4">4</option>
                    
                        <option value="5">5</option>
                    
                        <option value="6">6</option>
                    
                        <option value="7">7</option>
                    
                        <option value="8">8</option>
                    
                        <option value="9">9</option>
                    
                        <option value="10">10</option>
                    
                        <option value="13">13</option>
                    
                        <option value="14">14</option>
                    
                        <option value="16">16</option>
                    
                        <option value="17">17</option>
                    
                        <option value="18">18</option>
                    
                        <option value="19">19</option>
                    
                        <option value="23">23</option>
                    
                        <option value="24">24</option>
                    
                        <option value="26">26</option>
                    
                        <option value="B1">B1</option>
                    
                        <option value="B2">B2</option>
                    
                        <option value="B3">B3</option>
                    
                        <option value="B4">B4</option>
                    
                        <option value="B5">B5</option>
                    
                        <option value="C1">C1</option>
                    
                        <option value="C2">C2</option>
                    
                        <option value="CC">CC</option>
                    
                        <option value="F1">F1</option>
                    
                        <option value="F2">F2</option>
                    
                        <option value="F3">F3</option>
                    
                        <option value="F4">F4</option>
                    
                        <option value="F5">F5</option>
                    
                        <option value="F6">F6</option>
                    
                        <option value="H">H</option>
                    
                        <option value="LC">LC</option>
                    
                        <option value="LD">LD</option>
                    
                        <option value="LP">LP</option>
                    
                        <option value="M1">M1</option>
                    
                        <option value="M2">M2</option>
                    
                        <option value="M3">M3</option>
                    
                        <option value="M4">M4</option>
                    
                        <option value="M5">M5</option>
                    
                        <option value="M6">M6</option>
                    
                        <option value="M7">M7</option>
                    
                        <option value="P1">P1</option>
                    
                        <option value="P13">P13</option>
                    
                        <option value="P2">P2</option>
                    
                        <option value="P3">P3</option>
                    
                        <option value="P6">P6</option>
                    
                        <option value="P7">P7</option>
                    
                        <option value="PSC1">PSC1</option>
                    
                        <option value="PSC2">PSC2</option>
                    
                        <option value="PSC3">PSC3</option>
                    
                        <option value="SC">SC</option>
                    
                        <option value="U1">U1</option>
                    
                        <option value="U8">U8</option>
                    </select>
                </div>

                <div class="bg-vallabus-light p-4 rounded-lg space-y-3">
                    <p class="text-base text-center text-gray-700"><strong>Instrucciones</strong></p>
                    <div class="mt-0">
                        <a href="#" class="text-sm text-gray-600 underline flex items-center gap-2 font-normal" onclick="openVideoModal()">
                            <i data-lucide="play-circle" class="h-5 w-5"></i>
                            Ver vídeo explicativo
                        </a>
                    </div>
                    <ul class="space-y-2 text-sm text-gray-600">
                        <li class="flex items-center gap-2 pb-2">
                            Más abajo, al pulsar enviar, se abrirá el WhatsApp del ayuntamiento
                        </li>
                        <li class="flex items-center gap-2">
                            1. Manda el mensaje que aparece para iniciar
                        </li>
                        <li class="flex flex-col items-center gap-2 pb-5">
                            <img src="./img/paso1.jpg" alt="Paso 1: Manda el mensaje de inicio" class="w-60 h-auto rounded-lg shadow-sm mx-auto">
                        </li>
                        <li class="flex items-center gap-2">
                            2. Deja pulsado el cuadro de escritura y pulsa "Pegar", envía ese mensaje
                        </li>
                        <li class="flex flex-col items-center gap-2 pb-5">
                            <img src="./img/paso2.jpg" alt="Paso 2: Pulsa pegar" class="w-60 h-auto rounded-lg shadow-sm">
                        </li>
                        <li class="flex items-center gap-2">
                            3. Pulsa el botón "Finalizar Petición"
                        </li>
                        <li class="flex flex-col items-center gap-2 pb-5">
                            <img src="./img/paso3.jpg" alt="Paso 3: Pulsa en finalizar" class="w-60 h-auto rounded-lg shadow-sm">
                        </li>
                        <li class="flex items-center gap-2">
                            <i data-lucide="circle-check" class="h-6 w-6"></i>
                            <span>Recibiras un código de referencia<br /><strong>Vuelve a pegar si no te dió código</strong></span>
                        </li>
                    </ul>
                </div>
                
                <button type="button" onclick="generarQueja()" 
                        class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-vallabus text-white rounded-md hover:bg-opacity-90 transition-colors">
                    <i data-lucide="send" class="h-4 w-4"></i>
                    Enviar reclamación
                </button>

                <p class="text-sm text-gray-600">Consultar una reclamación ya realizada con el código de referencia</p>

                <a href="https://www.valladolid.es/es/sqi#proxia-restful-sqi.1.1!/n!/query" target="_blank" rel="noopener noreferrer"
                    class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-gray-200 text-gray-500 rounded-md hover:bg-gray-300 transition-colors">
                    <i data-lucide="search" class="h-4 w-4"></i>
                    Consultar existente
                </a>
            </form>
        </div>

        <!-- Share -->
        <div class="bg-white sm:p-6 p-4 rounded-lg shadow-sm border border-gray-100">
            <div class="text-center max-w-2xl mx-auto">
                <h2 class="text-xl font-semibold text-primary mb-5">
                    Tú puedes ayudar
                </h2>
                <button id="share-button" onclick="sharePage()" class="bg-primary text-base py-3 px-6 rounded-lg hover:opacity-90 transition duration-300 flex items-center gap-2 mx-auto mb-5">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" data-lucide="share-2" class="lucide lucide-share-2 h-5 w-5"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"></line><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"></line></svg>
                    Compartir este asistente
                </button>
                <p class="text-primary text-sm">
                    En redes sociales y grupos de chat para que otros puedan reclamar soluciones
                </p>
            </div>
        </div>

        <!-- Estadísticas -->
        <div class="bg-white sm:p-6 p-4 rounded-lg shadow-sm border border-gray-100">
            <div class="text-center max-w-2xl mx-auto">
                <h2 class="text-xl font-semibold text-primary mb-5">
                    Estadísticas
                </h2>
                <p class="text-primary text-sm mb-5">
                    Barrios y líneas por número de reclamaciones
                </p>
                <div class="grid sm:grid-cols-2 gap-4">
                    <!-- Listado de Barrios -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-semibold mb-3 text-vallabus">
                            <i data-lucide="building-2" class="inline mr-2"></i>
                            Barrios
                        </h3>
                        <ul id="barriosList" class="divide-y divide-gray-200"></ul>
                        <button onclick="toggleFullList('barrios')" 
                                class="mt-3 text-vallabus hover:underline text-sm" id="toggle-barrios">
                            Ver todos
                        </button>
                    </div>
                    
                    <!-- Listado de Líneas -->
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-semibold mb-3 text-vallabus">
                            <i data-lucide="bus" class="inline mr-2"></i>
                            Líneas
                        </h3>
                        <ul id="lineasList" class="divide-y divide-gray-200"></ul>
                        <button onclick="toggleFullList('lineas')" 
                                class="mt-3 text-vallabus hover:underline text-sm" id="toggle-lineas">
                            Ver todas
                        </button>
                    </div>
                    
                    <!-- Evolución por día -->
                    <div class="bg-gray-50 p-4 rounded-lg sm:col-span-2">
                        <h3 class="font-semibold mb-3 text-vallabus">
                            <i data-lucide="calendar" class="inline mr-2"></i>
                            Evolución por día
                        </h3>
                        <canvas id="complaintsChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Sobre VallaBus -->
         <!-- Sección informes -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden">
            
            <div class="sm:p-6 p-4">
                <div class="flex items-start gap-3">
                    <div>
                        <h2 class="text-xl font-semibold text-primary mb-2 flex items-center justify-center">
                            <i data-lucide="chart-column" class="h-8 w-8 text-vallabus mr-2"></i>
                            Informes de calidad
                        </h2>
                        <p class="text-primary text-sm leading-relaxed mb-4">
                            VallaBus analiza y publica mensualmente informes de calidad del servicio de AUVASA que demuestran una necesidad urgente de mejora
                        </p>
                        <div class="text-center">
                            <a href="../informes/" class="mt-1 inline-block bg-vallabus text-white text-base py-2 px-4 rounded hover:bg-vallabus transition duration-300">Ver informes</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Sección VallaBus -->
        <div id="vallabus" class="bg-white rounded-lg shadow-sm border border-gray-100 overflow-hidden">
            <!-- Imagen cover -->
            <img src="../../img/screenshot.jpg" alt="VallaBus Screenshot" class="w-full h-48 sm:h-64 md:h-72 lg:h-96 object-cover object-top">
            
            <div class="sm:p-6 p-4">
                <div class="flex items-start gap-3">
                    <div>
                        <h2 class="text-xl font-semibold text-primary mb-2">
                            VallaBus: Navega la incertidumbre
                        </h2>
                        <p class="text-primary text-sm leading-relaxed mb-4">
                            App creada por voluntarios y usuarios del bus a inicios de 2024, proporciona información precisa en Valladolid y alrededores
                        </p>
                        <div class="grid sm:grid-cols-3 gap-4">
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h3 class="font-medium text-primary mb-2 flex items-center gap-2">
                                    <i data-lucide="map-pin" class="h-5 w-5 text-primary"></i>
                                    Seguimiento en tiempo real
                                </h3>
                                <p class="text-sm text-primary">
                                    Visualiza en mapa la ubicación exacta de cada bus y su puntualidad
                                </p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h3 class="font-medium text-primary mb-2 flex items-center gap-2">
                                    <i data-lucide="bell" class="h-5 w-5 text-primary"></i>
                                    Llegadas precisas
                                </h3>
                                <p class="text-sm text-primary">
                                    Notificaciones en tiempo real sobre retrasos y adelantos
                                </p>
                            </div>
                            <div class="bg-gray-50 p-4 rounded-lg">
                                <h3 class="font-medium text-primary mb-2 flex items-center gap-2">
                                    <i data-lucide="route" class="h-5 w-5 text-primary"></i>
                                    Planificación inteligente
                                </h3>
                                <p class="text-sm text-primary">
                                    Rutas multimodales (bus + BIKI) basada en tiempos actualizados
                                </p>
                            </div>
                        </div>
                        <div class="mt-4 bg-gray-50 p-4 rounded-lg border border-vallabus flex items-center gap-4">
                            <i data-lucide="bus" class="h-32 w-32 text-primary"></i>
                            <div>
                                <p class="text-sm text-primary">
                                    Miles de usuarios consideran ya <a href="https://vallabus.com" target="_blank">VallaBus</a> la única solución a la falta de claridad en horarios y frecuencias
                                </p>
                                <a id="cta-button" href="https://vallabus.com" target="_blank" class="mt-4 inline-block bg-vallabus text-white text-base py-2 px-4 rounded hover:bg-vallabus transition duration-300 text-center">Probar ahora</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Síguenos -->
        <div class="bg-white sm:p-6 p-4 rounded-lg shadow-sm border border-gray-100 mt-4">
            <div class="text-center max-w-2xl mx-auto">
                <h2 class="text-xl font-semibold text-primary mb-4">Síguenos para más novedades</h2>
                <p class="text-primary text-sm mb-6">Mantente al día de iniciativas e informes de calidad</p>
                <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-4">
                    <a href="https://www.instagram.com/vallabusapp/" target="_blank" class="flex flex-col items-center justify-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-colors">
                        <i data-lucide="instagram" class="h-8 w-8 sm:h-12 sm:w-12 text-pink-600"></i>
                        <span class="text-sm font-medium">Instagram</span>
                    </a>
                    <a href="https://bsky.app/profile/vallabus.com" target="_blank" class="flex flex-col items-center justify-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-colors">
                        <i id="bluesky-icon" class="h-8 w-8 sm:h-12 sm:w-12 text-blue-500"></i>
                        <span class="text-sm font-medium">BlueSky</span>
                    </a>
                    <a href="https://whatsapp.com/channel/0029VacJrldIHphBU41MLM25" target="_blank" class="flex flex-col items-center justify-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-colors">
                        <i data-lucide="message-circle" class="h-8 w-8 sm:h-12 sm:w-12 text-green-600"></i>
                        <span class="text-sm font-medium">WhatsApp</span>
                    </a>
                    <a href="https://www.tiktok.com/@vallabusapp" target="_blank" class="flex flex-col items-center justify-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-colors">
                        <i data-lucide="play" class="h-8 w-8 sm:h-12 sm:w-12 text-gray-900"></i>
                        <span class="text-sm font-medium">TikTok</span>
                    </a>
                    <a href="https://www.facebook.com/profile.php?id=61561026144737" target="_blank" class="flex flex-col items-center justify-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-colors">
                        <i data-lucide="facebook" class="h-8 w-8 sm:h-12 sm:w-12 text-blue-600"></i>
                        <span class="text-sm font-medium">Facebook</span>
                    </a>
                    <a href="https://t.me/vallabusapp" target="_blank" class="flex flex-col items-center justify-center gap-2 p-3 rounded-lg hover:bg-gray-50 transition-colors">
                        <i data-lucide="send" class="h-8 w-8 sm:h-12 sm:w-12 text-blue-500"></i>
                        <span class="text-sm font-medium">Telegram</span>
                    </a>
                </div>
            </div>
        </div>

        <!-- Bloque de licencia -->
        <div class="bg-white sm:p-6 p-4 rounded-lg shadow-sm border border-gray-100">
            <div class="flex items-center gap-3 text-sm text-gray-600">
                <i data-lucide="copyright" class="h-8 w-8"></i>
                <p>
                    Esta web está bajo licencia 
                    <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.es" target="_blank">
                        Creative Commons Attribution-ShareAlike 4.0 International (CC BY-SA 4.0)
                    </a>
                </p>
            </div>
        </div>
    </div>

    <div id="videoModal" class="mt-0 pt-0 fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-4 rounded-lg max-w-3xl w-full">
            <div class="flex justify-end mb-2">
                <button onclick="closeVideoModal()" class="text-gray-500 hover:text-gray-700">
                    <i data-lucide="x" class="h-6 w-6"></i>
                </button>
            </div>
            <div id="videoContainer" class="aspect-w-16 aspect-h-9">
                <!-- El video se cargará aquí dinámicamente -->
            </div>
        </div>
    </div>

    <script>
        async function generarQueja() {
            const nombreInput = document.getElementById('nombre');
            const errorMessage = document.getElementById('nombre-error');
            
            // Validación del nombre
            if (!nombreInput.value.trim()) {
                nombreInput.classList.add('invalid');
                errorMessage.style.display = 'block';
                nombreInput.focus();
                return;
            } else {
                nombreInput.classList.remove('invalid');
                errorMessage.style.display = 'none';
            }

            const barrio = document.getElementById('barrio').value;
            const lineas = Array.from(document.getElementById('lineas').selectedOptions)
                               .map(option => option.value).join(', ');
            
            let mensaje = `Hola, mi nombre es ${nombreInput.value.trim()}`;
            let mensajeInit = 'Importante: 1. Manda este mensaje para iniciar. 2. Deja pulsado el cuadro de escritura y elige Pegar 3. Envía tu reclamación';

            if(barrio) {
                mensaje += `, vivo en ${barrio}`;
            }

            if (lineas) {
                mensaje += `, utilizo la línea ${lineas}`;
            }
            
            mensaje += `\n\nMe gustaría registrar una reclamación formal `;
            mensaje += `sobre baja calidad del servicio de AUVASA y en concreto su falta de cumplimiento `;
            mensaje += `de horarios y frecuencias que afecta a mis desplazamientos.\n\nSolicito que inviertan en nuevos vehículos y personal para garantizar el cumplimiento de horarios y frecuencias.\n\nUn saludo.`;

            // Enviamos evento de reclamación y guardamos fecha
            // Solo enviamos un evento por dia y usuario
            const hoy = new Date().toDateString();
            const ultimaReclamacion = localStorage.getItem('ultimaReclamacionFecha');

            if (typeof _paq !== 'undefined' && ultimaReclamacion !== hoy) {
                if (barrio) _paq.push(['trackEvent', 'Reclamacion', 'ReclamacionBarrio', barrio]);
                if (lineas) lineas.split(', ').forEach(linea => _paq.push(['trackEvent', 'Reclamacion', 'ReclamacionLinea', linea]));
                    _paq.push(['trackEvent', 'Reclamacion', 'ReclamacionEnviada', 'WhatsApp']);
                localStorage.setItem('ultimaReclamacionFecha', hoy);
                console.log('Se guardó evento de reclamación');
            } else {
                console.log('Ya mandaste una reclamación hoy, no guardamos evento');
            }

            try {
                await navigator.clipboard.writeText(mensaje);
                
                // Abrir WhatsApp
                const numeroWhatsApp = '34660010010';
                const url = `https://wa.me/${numeroWhatsApp}?text=${encodeURIComponent(mensajeInit)}`;
                window.open(url, '_blank');
                // Crear y mostrar el diálogo flotante
                showConfirmationDialog(nombreInput.value.trim());

            } catch (err) {
                // Fallback para navegadores antiguos
                const textarea = document.createElement('textarea');
                textarea.value = mensaje;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                
                const numeroWhatsApp = '34660010010';
                const url = `https://wa.me/${numeroWhatsApp}?text=${encodeURIComponent(mensaje)}`;
                window.open(url, '_blank');
            }
        }

        function showConfirmationDialog(nombre) {
            const dialog = document.createElement('div');
                dialog.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
                dialog.innerHTML = `
                    <div class="bg-white p-6 rounded-lg shadow-lg w-[90%] max-w-md relative">
                        <button onclick="this.closest('.fixed').remove()" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700">
                            <i data-lucide="x" class="h-6 w-6"></i>
                        </button>
                        <div class="flex flex-col items-center mb-4 text-center">
                            <i data-lucide="check-circle" class="h-10 w-10 text-vallabus mb-2"></i>
                            <h3 class="text-lg font-semibold">${nombre}, ¡muchas gracias!</h3>
                        </div>
                        <p class="text-sm mb-3">Verifica que has recibido <strong>un código al finalizar</strong>. Si no, vuelve a WhatsApp y pega el mensaje de nuevo.</p>
                        <p class="text-sm mb-4">Y sólo una última cosa...</p>
                        <button onclick="sharePage()" class="w-full bg-vallabus text-white py-2 px-4 rounded text-sm hover:bg-opacity-90 transition-colors flex items-center justify-center gap-2">
                            <i data-lucide="share-2" class="h-4 w-4"></i>
                            Comparte este asistente
                        </button>
                        <p class="text-sm mt-3">En redes sociales y grupos de chat para que otros puedan reclamar soluciones</p>
                    </div>
                `;
                document.body.appendChild(dialog);

                // Inicializar Lucide icons
                lucide.createIcons();
        }

        function sharePage() {
            const text = 'Pon una reclamación a AUVASA en segundos gracias al asistente de VallaBus\n\n';
            
            // Crear un objeto URL y modificarlo
            const url = new URL(window.location.href);
            url.hash = ''; // Eliminar anchor
            url.search = '?mtm_campaign=reclamashare'; // Reemplazar todos los parámetros
            
            // Registrar el evento en Matomo
            if (typeof _paq !== 'undefined') {
                _paq.push(['trackEvent', 'Reclamacion', 'Compartido', 'True']);
            }

            if (navigator.share) {
                navigator.share({
                    title: 'Asistente de reclamaciones a AUVASA',
                    text: text,
                    url: url.toString()
                })
                .catch((error) => console.log('Error compartiendo:', error));
            } else {
                // Fallback para navegadores que no soportan Web Share API
                const dummy = document.createElement('textarea');
                document.body.appendChild(dummy);
                dummy.value = text + url.toString();
                dummy.select();
                document.execCommand('copy');
                document.body.removeChild(dummy);
                alert('Texto y URL copiados al portapapeles');
            }
        }

        function openVideoModal() {
            const modal = document.getElementById('videoModal');
            const videoContainer = document.getElementById('videoContainer');
            modal.classList.remove('hidden');
            videoContainer.innerHTML = `
                <video src="./video/instrucciones.mp4" controls class="w-full h-full object-cover">
                    Tu navegador no soporta el elemento de video.
                </video>
            `;
        }

        function closeVideoModal() {
            const modal = document.getElementById('videoModal');
            const videoContainer = document.getElementById('videoContainer');
            modal.classList.add('hidden');
            videoContainer.innerHTML = ''; // Elimina el video al cerrar el modal
        }
    </script>

    <script>
        // Initialize Lucide icons
        lucide.createIcons();

        // Funciones de estadísticas

        // Guardar datos globalmente
        let statsData = null;

        function renderList(data, containerId, showAll = false) {
            const sortedData = Object.entries(data)
                .sort(([,a], [,b]) => b - a)
                .slice(0, showAll ? undefined : 10);

            const container = document.getElementById(containerId);
            container.innerHTML = sortedData.map(([name, count]) => `
                <li class="py-2 flex justify-between items-center">
                    <span class="text-gray-700">${name}</span>
                    <span class="bg-vallabus-light px-2 py-1 rounded text-sm">${count}</span>
                </li>
            `).join('');
        }

        // Desplegar las listas completas
        function toggleFullList(type) {
            if (!statsData) {
                console.error('Stats data not loaded yet');
                return;
            }

            const containerId = `${type}List`;
            const container = document.getElementById(containerId);
            const showAll = container.dataset.full !== 'true';
            const buttonId = `toggle-${type}`;
            
            renderList(statsData.totales[type], containerId, showAll);
            container.dataset.full = showAll.toString();
            document.getElementById(buttonId).innerText = showAll ? 
                (type === 'barrios' ? 'Mostrar menos' : 'Mostrar menos') : 
                (type === 'barrios' ? 'Ver todos' : 'Ver todas');
        }

        // Cargar y renderizar datos
        async function fetchStats() {
            try {
                const response = await fetch('https://datos.vallabus.com/reclamaciones/stats_reclamaciones.json');
                statsData = await response.json();

                // Actualizar el DOM con los datos
                document.getElementById('total-reclamaciones').textContent = statsData.totales.total_reclamaciones;
                document.getElementById('total-barrios').textContent = Object.keys(statsData.totales.barrios).length;

                // Renderizar listas
                renderList(statsData.totales.barrios, 'barriosList');
                renderList(statsData.totales.lineas, 'lineasList');

                // Preparar los datos para el gráfico
                const complaintsData = {
                    labels: [],
                    datasets: [{
                        label: 'Reclamaciones totales',
                        data: [],
                        backgroundColor: '#ecf8f6',
                        borderColor: '#2b7b6c',
                        borderWidth: 1
                    }]
                };

                // Llenar los datos del gráfico desde el historial
                for (const fecha in statsData.historico) {
                    const [year, month, day] = fecha.split('-');
                    const formattedDate = `${day}/${month}`;
                    complaintsData.labels.push(formattedDate);
                    complaintsData.datasets[0].data.push(statsData.historico[fecha].total_reclamaciones);
                }

                // Dibujar el gráfico
                const ctx = document.getElementById('complaintsChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: complaintsData,
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        },
                        plugins: {
                            legend: {
                                display: true,
                                position: 'bottom',
                                labels: {
                                    color: '#333',
                                    font: {
                                        size: 12
                                    }
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        // Llamar a la función para cargar los datos
        fetchStats();

        // Matomo tracking
        var _paq = window._paq = window._paq || [];
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
            var u="https://stats.vallabus.com/";
            _paq.push(['setTrackerUrl', u+'matomo.php']);
            _paq.push(['setSiteId', '6']);
            var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
            g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
        })();
    </script>
</body>
</html>
